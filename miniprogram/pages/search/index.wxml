<!-- pages/search/index.wxml -->
<wxs src="../../utils/filters.wxs" module="f"></wxs>

<!-- 自定义导航栏：与首页一致的搜索框位置与风格 -->
<view class="custom-nav" style="height: {{navBarHeight}}px; padding-top: {{statusBarHeight}}px;">
  <view class="nav-row" style="height: {{navBarHeight}}px; padding-right: {{capsuleRightWidth}}px;">
    <view class="search-box" style="height: {{menuHeight}}px;">
      <input class="search-input" style="height: 100%;" disabled="true" placeholder="在下方填写条件后点击“搜索”" value="" />
    </view>
    <text class="cancel-btn" style="height: {{menuHeight}}px; line-height: {{menuHeight}}px;" bindtap="onCancel">返回</text>
  </view>
</view>
<view style="height: {{navHeight}}px;"></view>

<view class="search-page">
  <view wx:if="{{noResult}}" class="no-result">{{noResultText}}</view>
  

  <view class="history-section" wx:if="{{history && history.length}}">
    <view class="section-title">
      <text>最近搜索</text>
      <text class="clear" bindtap="onClearHistory">清空</text>
    </view>
    <view class="history-list">
      <block wx:for="{{history}}" wx:key="index">
        <view class="history-chip" bindtap="onTapHistory" data-field="{{item.field}}" data-value="{{item.value}}" data-filters="{{item.filters}}" data-type="{{item.type}}">
          <block wx:if="{{item && item.filters}}">
            <text>{{f.formatFilters(item.filters)}}</text>
          </block>
          <block wx:else>
            <text>{{f.getFieldLabel(item.field)}}：{{item.value}}</text>
          </block>
        </view>
      </block>
    </view>
  </view>

  <!-- 多字段组合搜索（平铺输入） -->
  <view class="advanced-section">
    <view class="section-title">多字段组合搜索</view>
    <view class="field-row">
      <text class="field-label">{{f.getFieldLabel('frame_model')}}</text>
      <input class="field-input" type="text" placeholder="输入型号，例如 98044" value="{{filters.frame_model}}" data-field="frame_model" bindinput="onInputMulti" />
    </view>
    <view class="field-row">
      <text class="field-label">{{f.getFieldLabel('lens_size')}}</text>
      <input class="field-input {{errors.lens_size?'error':''}}" type="text" placeholder="数字或范围，例如 50 或 40-45" value="{{filters.lens_size}}" data-field="lens_size" bindinput="onInputMulti" />
      <view class="field-error" wx:if="{{errors.lens_size}}">{{errors.lens_size}}</view>
    </view>
    <view class="field-row">
      <text class="field-label">{{f.getFieldLabel('nose_bridge_width')}}</text>
      <input class="field-input {{errors.nose_bridge_width?'error':''}}" type="text" placeholder="数字或范围，例如 18 或 16-20" value="{{filters.nose_bridge_width}}" data-field="nose_bridge_width" bindinput="onInputMulti" />
      <view class="field-error" wx:if="{{errors.nose_bridge_width}}">{{errors.nose_bridge_width}}</view>
    </view>
    <view class="field-row">
      <text class="field-label">{{f.getFieldLabel('temple_length')}}</text>
      <input class="field-input {{errors.temple_length?'error':''}}" type="text" placeholder="数字或范围，例如 145 或 140-150" value="{{filters.temple_length}}" data-field="temple_length" bindinput="onInputMulti" />
      <view class="field-error" wx:if="{{errors.temple_length}}">{{errors.temple_length}}</view>
    </view>
    <view class="field-row">
      <text class="field-label">{{f.getFieldLabel('frame_total_length')}}</text>
      <input class="field-input {{errors.frame_total_length?'error':''}}" type="text" placeholder="数字或范围，例如 140 或 135-145" value="{{filters.frame_total_length}}" data-field="frame_total_length" bindinput="onInputMulti" />
      <view class="field-error" wx:if="{{errors.frame_total_length}}">{{errors.frame_total_length}}</view>
    </view>
    <view class="field-row">
      <text class="field-label">{{f.getFieldLabel('frame_height')}}</text>
      <input class="field-input {{errors.frame_height?'error':''}}" type="text" placeholder="数字或范围，例如 42 或 40-45" value="{{filters.frame_height}}" data-field="frame_height" bindinput="onInputMulti" />
      <view class="field-error" wx:if="{{errors.frame_height}}">{{errors.frame_height}}</view>
    </view>
    <button class="btn-search" type="primary" bindtap="onSearchMulti">搜索</button>
  </view>

  <view class="help-section">
    <view class="section-title">搜索说明</view>
    <view class="help-text">{{helpText}}</view>
  </view>
</view>
